<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Emerging Technogies Assignment</title>
  <meta name="description" content="An application for handwritten digit recognition.">
  <meta name="author" content="Tara O'Kelly">
  <meta name="student_number" content="Tara O'Kelly">
  <link rel="stylesheet" href="static/css/style.css" /> 

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
    <div id="extra_content" class="side_nav">
    </div>
    <div id="main_content">
      <div class="navbar">
          <div id="nav-icon">
              <span></span>
              <span></span>
              <span></span>
              <span></span>
            </div>
      </div>
      <div id="main_content_body">
        <div class="uploaders_container left">
          <h2>Upload a file for analysis:</h2>
          <form method=post enctype=multipart/form-data>
              <p><input type=file name=file>
                <input  class="upload" type=submit value=Upload>
          </form>
          <div class="spacer"></div>
          <h2>... or draw one:</h2>
          <button id="reset" onclick="reset()">Clear</button>
          <button id="upload" class="upload" onclick="upload()">Upload</button>
          <div style="clear: both"></div>
          <canvas id="paint" width="375" height="275">Update your browser to support HTML5 Canvas</canvas>
          <div class="spacer"></div>
        </div>

        

        <div class="results_container left">
        </div>
      </div>
    </div>
    <script src="static/js/css-element-queries/src/ResizeSensor.js"></script>
    <script src="static/js/css-element-queries/src/ElementQueries.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>
    // Get canvas.
    var canvas = document.getElementById("paint");
    var ctx = canvas.getContext("2d");
    var width = canvas.width, height = canvas.height;
    var hold = false;

    // Pencil tool.
    // Adapted from: https://nidhinp.wordpress.com/2014/02/19/paint-app-in-flask/      

    // On mouse clicked get co-ordinates, get hold and begin path.
    canvas.onmousedown = function (e){
        curX = e.clientX - canvas.offsetLeft;
        curY = e.clientY - canvas.offsetTop;
        hold = true;
              
        prevX = curX;
        prevY = curY;
        ctx.beginPath();
        ctx.moveTo(prevX, prevY);
    };

    // Get co-ordinates and draw if hold is still true.    
    canvas.onmousemove = function (e){
        if(hold){
            curX = e.clientX - canvas.offsetLeft;
            curY = e.clientY - canvas.offsetTop;
            draw();
        }
    };

    // Release hold on mouse button is released.    
    canvas.onmouseup = function (e){
        hold = false;
    };

    // Release hold on mouse out of canvas.   
    canvas.onmouseout = function (e){
        hold = false;
    };

    // Draw line   
    function draw (){
        ctx.lineTo(curX, curY);
        ctx.stroke();
    }

    // Reset tool.
    // Adapted from: https://stackoverflow.com/questions/2142535/how-to-clear-the-canvas-for-redrawing
    function reset(){
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function openNav() {
        document.getElementById("extra_content").style.width = "250px";
        document.getElementById("main_content").style.marginLeft = "250px";
    }

    function closeNav() {
        document.getElementById("extra_content").style.width = "0";
        document.getElementById("main_content").style.marginLeft= "0";
    }
    function update(){
        // here is the most important part because if you dont replace you will get a DOM 18 exception.
        var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream"); 
        // it will save locally
        window.location.href=image; 
    }

    $(document).ready(function(){
      $('#nav-icon').click(function(){
        $('#nav-icon,.side_nav,#main_content').toggleClass('open');
      });
    });

    /*new ResizeSensor(jQuery('#main_content_body'), function(){ 
      console.log('content dimension changed');
      $('.navbar').width('#main_content_body');
    });*/
    
    </script>
</body>
</html>